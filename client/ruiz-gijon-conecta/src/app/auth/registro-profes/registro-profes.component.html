<form (ngSubmit)="onSubmit()" class="needs-validation d-flex flex-column flex-grow-1"
    style="min-height: calc(100vh - 210px);" novalidate #registroProfesorForm="ngForm">

    <!-- contenido principal -->
    <div class="row mb-3 justify-content-between gap-3 flex-grow-1 mx-2">

        <!-- caja grande -->
        <section class="col bg-white rounded-2 shadow p-4 d-flex flex-column flex-grow-1">
            <legend class="fw-bold fs-2">Registrarse como profesor</legend>

            <!-- Nombre completo -->
            <div class="mt-3">
                <label for="input-name" class="form-label text-uppercase text-secondary">Nombre completo</label>
                <input type="text" class="form-control text-secondary" id="input-name"
                    placeholder="Ejemplo: John Doe" required (ngModelChange)="onFormChange()" [(ngModel)]="name" name="name" />
                <div class="valid-feedback">Correcto</div>
                <div class="invalid-feedback">Debes completar el nombre completo</div>
            </div>

            <!-- Correo electr√≥nico -->
            <div class="mt-3">
                <label for="input-email" class="form-label text-uppercase text-secondary">Correo electr√≥nico</label>
                <input type="email" class="form-control text-secondary" id="input-email"
                    placeholder="ejemplo@correo.com" required (ngModelChange)="onFormChange()" [(ngModel)]="email" name="email" #emailInput="ngModel"
                    pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$" />
                <div *ngIf="emailInput.invalid && emailInput.touched" class="invalid-feedback d-block">
                    <div *ngIf="emailInput.errors?.['required']">El correo es obligatorio</div>
                    <div *ngIf="emailInput.errors?.['pattern']">El formato del correo no es v√°lido</div>
                </div>
            </div>

            <!-- Contrase√±a -->
            <div class="mt-3">
                <label for="input-password" class="form-label text-uppercase text-secondary">Contrase√±a</label>
                <input type="password" class="form-control text-secondary" id="input-password" placeholder="********"
                    required (ngModelChange)="onFormChange()" [(ngModel)]="password" name="password" #passwordInput="ngModel"
                    (ngModelChange)="validarPassword()" />
                <div *ngIf="passwordInput.touched && !passwordValida" class="invalid-feedback d-block">
                    La contrase√±a debe tener:
                    <ul>
                        <li>Al menos 8 caracteres</li>
                        <li>1 may√∫scula</li>
                        <li>1 min√∫scula</li>
                        <li>1 n√∫mero</li>
                        <li>1 s√≠mbolo</li>
                    </ul>
                </div>
            </div>

            <!-- Confirmar Contrase√±a -->
            <div class="mt-3">
                <label for="input-confirm-password" class="form-label text-uppercase text-secondary">Confirmar
                    contrase√±a</label>
                <input type="password" class="form-control text-secondary" id="input-confirm-password"
                    placeholder="********" required (ngModelChange)="onFormChange()" [(ngModel)]="confirmPassword" name="confirmPassword"
                    #confirmPasswordInput="ngModel" (ngModelChange)="validarConfirmPassword()" />
                <div *ngIf="confirmPasswordInput.touched && !passwordsCoinciden" class="invalid-feedback d-block">
                    Las contrase√±as no coinciden
                </div>
            </div>


            <!-- Departamento -->
            <div class="mt-3">
                <label for="input-departamento" class="form-label text-uppercase text-secondary">Departamento</label>
                <input type="text" class="form-control text-secondary" id="input-departamento"
                    placeholder="Ejemplo: Inform√°tica" required (ngModelChange)="onFormChange()" [(ngModel)]="departamento" name="departamento" />
                <div class="valid-feedback">Correcto</div>
                <div class="invalid-feedback">Debes completar el departamento</div>
            </div>

        </section>

        <!-- DERECHA -->
        <div class="col-lg-4">

            <!-- segunda parte formulario -->

            <!-- üèûÔ∏è IMAGEN -->
            <div class="row bg-white rounded-2 shadow py-4 px-2">
                <div class="col-12">
                    <label class="form-label text-uppercase text-secondary">Imagen de perfil</label>
                    <input type="file" class="form-control" (change)="fileChangeEvent($event)" accept="image/*" />
                </div>

                <!-- Editor de imagen -->
                <div class="col-12 mt-3" *ngIf="showCropper">
                    <image-cropper [imageChangedEvent]="imageChangedEvent" [maintainAspectRatio]="true"
                        [aspectRatio]="1" [transform]="transform" format="jpeg" (imageCropped)="imageCropped($event)"
                        style="max-height: 300px;">
                    </image-cropper>

                    <div class="mt-3 d-flex gap-2">
                        <button type="button" class="btn btn-outline-primary" (click)="rotateLeft()">
                            <i class="bi bi-arrow-counterclockwise"></i> Rotar Izquierda
                        </button>
                        <button type="button" class="btn btn-outline-primary" (click)="rotateRight()">
                            <i class="bi bi-arrow-clockwise"></i> Rotar Derecha
                        </button>
                    </div>
                </div>

                <!-- Vista previa -->
                <div class="col-12 mt-3" *ngIf="croppedImage">
                    <p class="text-success">Vista previa del recorte:</p>
                    <img [src]="croppedImage" class="img-thumbnail" style="max-width: 150px;">
                </div>
            </div>

            <!-- ENV√çO FORMULARIO -->
            <div
                class="row bg-white rounded-2 shadow py-4 px-2 mt-3 align-items-center justify-content-center text-center">
                <div class="col-12 col-sm-6 col-lg-7 mb-3 mb-sm-0">
                    <h4 class="fw-bold mb-3">¬øListo para registrarte?</h4>
                    <button type="submit" class="btn btn-primary rounded-5 py-1 px-3 shadow-sm">Registrarse</button>
                </div>
                <div class="col-8 col-sm-4 col-lg-5">
                    <img src="assets/img/perfil.png" alt="Imagen para env√≠o" class="img-fluid rounded-circle">
                </div>
            </div>

        </div>

    </div>
</form>

<!-- MODAL: Formulario para confirmar salida sin guardar cambios -->
<ng-template #modalConfirmarSalida let-modal>
    <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title">Cambios sin guardar</h5>
        <button type="button" class="btn-close" (click)="modal.dismiss()" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        <p>Has realizado cambios que no se han guardado. ¬øSeguro que quieres salir?</p>
    </div>
    <div class="modal-footer">
        <button class="btn btn-warning" (click)="modal.dismiss()">Cancelar</button>
        <button class="btn btn-danger" (click)="modal.close()">Salir sin guardar</button>
    </div>
</ng-template>